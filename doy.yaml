build:
  - name: web
    cmd: npm run build
    cwd: web
  - name: image
    cmd: docker buildx build {build_args} -f dev/Dockerfile -t fans656/auth .
    args:
      build_args: 
        value: --build-arg http_proxy=\"$HTTP_PROXY\" --build-arg https_proxy=\"$HTTPS_PROXY\"
        eval: true
test:
  - name: back
    cmd: PIPENV_PIPFILE="auth/Pipfile" pipenv run pytest auth {args}
    args: true
  - name: inte
    cmd: npx playwright test --config=playwright.config.js
    cwd: inte
    with:
      - name: auth-server-web
        cmd: npm run dev
        cwd: web
      - name: prepare-data
        cmd: rm -rf tmp && mkdir tmp && cp inte/sample-data/* tmp/
        cwd: .
      - name: auth-server-back
        cmd: PIPENV_PIPFILE="auth/Pipfile" pipenv run python -m auth serve -d tmp
        cwd: .
      #- name: resource-server
      #  cmd: npm run dev
      #  cwd: inte/sample-resource-server
serve:
  - name: back
    cmd: PIPENV_PIPFILE="auth/Pipfile" pipenv run python -m auth serve {args}
    args: true
  - name: web
    cmd: npm run dev
    cwd: web
